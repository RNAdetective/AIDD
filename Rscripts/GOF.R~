library("ggplot2")
library("plyr")
## this creates tables for bargraphs
results <- read.csv("resultsall.csv")
colnames(results)[c(1)] <- c("gene_name")
GCMedit <- read.csv("gene_count_matrixedited.csv")
folder <- "/home/user/AIDD/gene_list/DESeq2G/"
files <- list.files(path=folder, pattern="*.csv") # create list of all .csv files in folder
# read in each .csv file in files and rbind them into a data frame called data 
data <- 
do.call("rbind", 
          lapply(files, 
                 function(x) 
                 read.csv(paste(folder, x, sep=''), )))
table <- merge(data, GCMedit, by="gene_name", sort=F)
RGtable <- merge(table, results, by="gene_name", sort=F)
RGtable2 <- t(RGtable)
colnames(RGtable2) <- RGtable[,1]
RGtable3 <- RGtable2[-c(1, 2, 7, 8, 9, 10, 11, 12), ]
write.csv(RGtable3, "RGtable3.csv")
RGtable3 <- read.csv("RGtable3.csv")
colnames(RGtable3)[1] <- "sample"
Data <- read.csv("PHENO_DATA.csv")
RGtable4 <- merge(Data, RGtable3, by="sample", sort=F)
ALL <- aggregate(RGtable4[, 6:8], list(RGtable4$condition), mean)
ALL1 <- t(ALL)
ALL2 <- ALL1[-c(1),]
write.csv(ALL2, "5.csv")
write.csv(ALL2, "6.csv")
ALL5 <- read.csv("5.csv")
colnames(ALL5)[1] <- "gene_name"
ALLG <- ALL5$V2 <- NULL
colnames(ALL5)[2] <- "counts"
ALL6 <- read.csv("6.csv")
ALLE <- colnames(ALL6)[1] <- "gene_name"
ALLH <- ALL6$V1 <- NULL
ALLI <- colnames(ALL6)[2] <- "counts"
ALL5["condition"] <- "condition:1"
ALL6["condition"] <- "condition:2"
final <- rbind(ALL5, ALL6)
tiff("ADARGene.tiff")
ggplot(final, aes(x=gene_name, y=counts, fill=condition)) +
    geom_bar(stat="identity", position=position_dodge(), colour="black")
dev.off()
colnames(ALL5)[2] <- "Meancondition:1"
colnames(ALL6)[2] <- "Meancondition:2"
ALL5$condition <- NULL
ALL6$condition <- NULL
mergetable <- merge(ALL5, ALL6, by="gene_name")
allfinal <- merge(mergetable, RGtable, by="gene_name")
allfinal2 <- allfinal[,-c(4:19)]
write.csv(allfinal2, "ADARGene.csv", row.names=FALSE)
sessionInfo()
